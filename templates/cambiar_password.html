{% extends "layout.html" %}

{% block title %}Cambiar Contrase침a{% endblock %}
{% block page_title %}Cambio de Contrase침a Obligatorio{% endblock %}

{% block content %}
<div class="row justify-content-center mt-4">
    <div class="col-lg-6 col-md-8">
        <div class="card border shadow-xs">
            <div class="card-header border-bottom pb-0">
                <h6 class="font-weight-semibold text-lg mb-0">游 Actualiza tu Contrase침a</h6>
                <p class="text-sm mb-3">Tu contrase침a actual es gen칠rica. Crea una nueva para continuar.</p>
                <div class="alert alert-light text-xs" role="alert">
                    <strong>Requisitos:</strong>
                    <ul class="mb-0 ps-3">
                        <li id="rule-length" class="text-danger">M칤nimo 8 caracteres</li>
                        <li id="rule-number" class="text-danger">Al menos un n칰mero</li>
                        <li id="rule-letter" class="text-danger">Al menos una letra</li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('cambiar_password_forzado') }}" id="passwordForm">
                    <div class="mb-3">
                        <label for="new_password" class="form-label">Nueva Contrase침a</label>
                        <input type="password" class="form-control" id="new_password" name="new_password" required onkeyup="validarPassword()">
                    </div>
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">Confirmar Nueva Contrase침a</label>
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" required onkeyup="validarCoincidencia()">
                        <div id="match-msg" class="form-text text-danger" style="display:none;">Las contrase침as no coinciden</div>
                    </div>
                    <div class="text-end">
                        <button type="submit" class="btn btn-primary btn-sm mb-0" id="submitBtn" disabled>Guardar Contrase침a</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function validarPassword() {
    const p = document.getElementById('new_password').value;
    
    // Reglas
    const length = p.length >= 8;
    const number = /\d/.test(p);
    const letter = /[a-zA-Z]/.test(p);

    // Actualizar visualmente
    document.getElementById('rule-length').className = length ? 'text-success' : 'text-danger';
    document.getElementById('rule-number').className = number ? 'text-success' : 'text-danger';
    document.getElementById('rule-letter').className = letter ? 'text-success' : 'text-danger';

    validarCoincidencia(); // Chequear tambi칠n si coinciden
}

function validarCoincidencia() {
    const p1 = document.getElementById('new_password').value;
    const p2 = document.getElementById('confirm_password').value;
    const btn = document.getElementById('submitBtn');
    const msg = document.getElementById('match-msg');

    // Reglas b치sicas
    const length = p1.length >= 8;
    const number = /\d/.test(p1);
    const letter = /[a-zA-Z]/.test(p1);
    const match = (p1 === p2) && (p1 !== "");

    // Mostrar error de coincidencia
    if (p2 !== "" && p1 !== p2) {
        msg.style.display = 'block';
    } else {
        msg.style.display = 'none';
    }

    // Habilitar bot칩n solo si TODO est치 bien
    if (length && number && letter && match) {
        btn.disabled = false;
    } else {
        btn.disabled = true;
    }
}
</script>
{% endblock %}